name: Notify

permissions:
  contents: read

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send notification
        env:
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: |
          SANITIZED_COMMIT_MESSAGE=$(echo "$COMMIT_MESSAGE" | tr '\n' ' ')
          
          curl -X POST \
            "https://${{ secrets.APIURL }}/send_group_msg" \
            -H "Authorization: Bearer ${{ secrets.APITOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
                 "group_id": "1049806011",
                 "message": [
                   {
                     "type": "text",
                     "data": {
                       "text": "ğŸ“¢ ä¸»åˆ†æ”¯å·²æ›´æ–°ï¼\n\nğŸ‘¤ ä½œè€…: ${{ github.actor }}\nğŸ“ æè¿°: '"$SANITIZED_COMMIT_MESSAGE"'\nğŸ”— æäº¤: ${{ github.sha }}"
                     }
                   }
                 ]
               }'
